name: "fast-bird"

services:
  entry:
    image: nginx:1.27.1-alpine
    init: true
    secrets:
      - source: blldxt91fy_fullchain
        target: /run/secrets/blldxt91fy_fullchain.pem
      - source: blldxt91fy_privkey
        target: /run/secrets/blldxt91fy_privkey.pem
      - source: comblldxtfy_fullchain
        target: /run/secrets/comblldxtfy_privkey.pem
      - source: comblldxtfy_privkey
        target: /run/secrets/comblldxtfy_privkey.pem
    configs:
      - source: nginx_frps
        target: /etc/nginx/templates/blldxt91fy.frps.conf.template
    ports:
      - "80:80"
      - "443:443"
  frps:
    image: fast_bird_frps
    hostname: top.grayless.frps
    build:
      target: frps
    init: true
    tty: true
    configs:
      - source: frps
        target: /etc/frps.toml
    expose:
      - 7000
      - 7500
      - 5002
      - 8082
    ports:
      - "7000:7000"

configs:
  frps:
    file: config/frp/frps.toml
  nginx_frps:
    file: config/entry/conf.d/blldxt91fy.frps.conf

secrets:
  blldxt91fy_fullchain:
    file: /etc/letsencrypt/live/blldxt91fy.frps.grayless.top/fullchain.pem
  blldxt91fy_privkey:
    file: /etc/letsencrypt/live/blldxt91fy.frps.grayless.top/privkey.pem
  comblldxtfy_fullchain:
    file: /etc/letsencrypt/live/blldxt91fy.frps.grayless.top/fullchain.pem
  comblldxtfy_privkey:
    file: /etc/letsencrypt/live/blldxt91fy.frps.grayless.top/privkey.pem
